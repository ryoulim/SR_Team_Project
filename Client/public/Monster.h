#pragma once
#include "Client_Defines.h"
#include "GameInstance.h"
#include "GameObject.h"

BEGIN(Engine)
class CTexture;
class CVIBuffer_Rect;
class CTransform;
END

BEGIN(Client)

class CMonster abstract : public CGameObject
{
public:
	enum MODE
	{
		MODE_WAIT, MODE_ATTACK, MODE_DETECTIVE, MODE_END
	};


public:
	typedef struct tagMonsterDesc : public CTransform::DESC
	{
		_float3		vPosition;
	}DESC;

protected:
	CMonster(LPDIRECT3DDEVICE9 pGraphic_Device);
	CMonster(const CMonster& Prototype);
	virtual ~CMonster() = default;

public:
	virtual HRESULT Initialize_Prototype() override;
	virtual HRESULT Initialize(void* pArg) override;
	virtual void Priority_Update(_float fTimeDelta) override;
	virtual EVENT Update(_float fTimeDelta) override;
	virtual void Late_Update(_float fTimeDelta) override;

public:
	virtual HRESULT SetUp_RenderState();
	virtual HRESULT Render();
	virtual HRESULT Release_RenderState();

protected:
	virtual HRESULT Ready_Components(void* pArg);

public: // 길찾기 및 디텍티브
	virtual void PlayerDistance();

protected: // 충돌함수
	virtual _float3		CalculateEffectPos();
	virtual void		On_Collision(CGameObject* pCollisionedObject, const _wstring& strLayerTag) {};

public:
	virtual CGameObject* Clone(void* pArg) PURE;
	virtual void Free();


/************************/
protected: // 이하 애니메이션 용도 
	virtual HRESULT Ready_Textures() { return S_OK; }	// 텍스쳐 컴포넌트들 로딩, *부모에 일반몹 용도로 작성하고 보스만 오버라이딩 하기?
	void	Compute_ViewAngle();			// 몬스터-플레이어 간 시선 각도 차 계산 
	virtual HRESULT Set_TextureType() { return S_OK; }	// enum을 uint변수로 옮기는 작업(그냥 함수로 뺌)
	virtual HRESULT Animate_Monster();		// 애니메이션 설정 (위의 함수랑 겹치나??)

protected:
	_uint	m_iState = {};					// 애니메이션 종류 선택(공격, 이동 ...)
	_uint	m_iDegree = {};					// 애니메이션 시선 각 선택
	_float	m_fPlayersViewAngle = {};		// 시선 각

	typedef _uint STATE;		// 텍스쳐 컴포넌트 (해치지않아요)
	typedef _uint VIEWDEGREE;
	typedef unordered_map<VIEWDEGREE, CTexture*> TEXTURE_DEGREE;
	unordered_map<STATE, TEXTURE_DEGREE> m_pTextureMap;		// 1Key: 종류 , 2key: 각도, value: CTexture
/************************/									// 이후 m_pTextureMap[m_iState][m_iDegree]->Bind_Resource호출 시
															// 매개변수로 m_fAnimationFrame 전달
		

protected: //기본정보
	LEVEL				m_eLevelID = { LEVEL_END };
	const _tchar*		m_szTextureID = { nullptr };  // 직접 입력할지도..
	const _tchar*		m_szBufferType = { nullptr };

protected: //컴포넌트
	CTexture*	m_pTextureCom = { nullptr };
	CVIBuffer*	m_pVIBufferCom = { nullptr };
	CTransform* m_pTransformCom = { nullptr };




protected: //충돌	
	CCollider* m_pCollider = { nullptr };

protected: //속성
	_int	m_iHP			= 100;
	_int	m_iAttackPower	= 10;
	_int	m_iDefense		= 5;
	_float	m_fSpeed		= 1.0f;
	_float3	m_vScale		= { 0.f, 0.f, 0.f };
	_float3 m_vPosition		= { 0.f, 0.f, 0.f };
	MODE	m_eBehavior		= MODE::MODE_END;

protected: //부속성
	vector<string>	m_vDropItems	= {};
	string			m_strDialogue	= "Grrrr...";
	string			m_strSound		= "SoundFilePath";

protected: //플레이어
	CGameObject*	m_pTargetPlayer	= nullptr;

protected: //기능성 수치
	_float			m_fPlayerDistance = 0;

protected:
	bool			m_bDead = false;



};

END
